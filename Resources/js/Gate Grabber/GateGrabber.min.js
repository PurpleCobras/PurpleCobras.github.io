function keyDownHandler(e){e.keyCode==rightkey&&(rightPressed=!0),e.keyCode==leftkey&&(leftPressed=!0),32==e.keyCode&&(spacePressed=!0),77==e.keyCode&&(0==mute?(mute=!0,music.pause(),music.currentTime=0):1==mute&&(mute=!1,music.play()))}function keyUpHandler(e){e.keyCode==rightkey&&(rightPressed=!1),e.keyCode==leftkey&&(leftPressed=!1),32==e.keyCode&&(spacePressed=!1)}function drawBall(){ctx.beginPath(),ctx.arc(ball.x,ball.y,ball.radius,0,2*Math.PI),ctx.fillStyle="#000000",ctx.fill(),ctx.closePath()}function draw2x(){ctx.beginPath(),ctx.arc(doublepts.x,doublepts.y,doublepts.radius,0,2*Math.PI),ctx.fillStyle="rgba(255, 0, 0,"+doublepts.alpha+")",ctx.fill(),ctx.closePath()}function drawextralife(){ctx.beginPath(),ctx.arc(extralife.x,extralife.y,extralife.radius,0,2*Math.PI),ctx.fillStyle="rgba(0, 150, 0,"+extralife.alpha+")",ctx.fill(),ctx.closePath()}function drawGate(e,t,a){0==a?(ctx.beginPath(),ctx.drawImage(gateType0,e,t,60,120),ctx.closePath()):1==a?(ctx.beginPath(),ctx.drawImage(gateType1,e,t,60,120),ctx.closePath()):2==a?(ctx.beginPath(),ctx.drawImage(gateType2,e,t,60,120),ctx.closePath()):3==a?(ctx.beginPath(),ctx.drawImage(gateType3,e,t,60,120),ctx.closePath()):4==a?(ctx.beginPath(),ctx.drawImage(gateType4,e,t,60,120),ctx.closePath()):5==a?(ctx.beginPath(),ctx.drawImage(gateType5,e,t,60,120),ctx.closePath()):6==a?(ctx.beginPath(),ctx.drawImage(gateType6,e,t,60,120),ctx.closePath()):7==a?(ctx.beginPath(),ctx.drawImage(gateType7,e,t,60,120),ctx.closePath()):8==a?(ctx.beginPath(),ctx.drawImage(gateType8,e,t,60,120),ctx.closePath()):9==a?(ctx.beginPath(),ctx.drawImage(gateType9,e,t,60,120),ctx.closePath()):10==a?(ctx.beginPath(),ctx.drawImage(gateType10,e,t,60,120),ctx.closePath()):11==a?(ctx.beginPath(),ctx.drawImage(gateType11,e,t,60,120),ctx.closePath()):12==a?(ctx.beginPath(),ctx.drawImage(gateType12,e,t,60,120),ctx.closePath()):13==a?(ctx.beginPath(),ctx.drawImage(gateType13,e,t,60,120),ctx.closePath()):14==a?(ctx.beginPath(),ctx.drawImage(gateType14,e,t,60,120),ctx.closePath()):15==a&&(ctx.beginPath(),ctx.drawImage(gateType15,e,t,60,120),ctx.closePath())}function changeGate(e){1==e&&(temp=Math.floor(16*Math.random()),gate1.type=temp,gate1.need=neededValue(gate1.type)),2==e&&(temp=Math.floor(16*Math.random()),gate2.type=temp,gate2.need=neededValue(gate2.type)),3==e&&(temp=Math.floor(16*Math.random()),gate3.type=temp,gate3.need=neededValue(gate3.type))}function neededValue(e){var t=0;return 0==e?t=2:1==e?t=2:2==e?t=0:3==e?t=0:4==e?t=3:5==e?t=1:6==e?t=3:7==e?t=1:8==e?t=0:9==e?t=0:10==e?t=3:11==e?t=3:12==e?t=1:13==e?t=2:14==e?t=1:15==e&&(t=2),t}function checkMatch(e){"gate1"==e?gate1.need==player.value||2==gate1.need?(1==collected2x?player.score+=200:player.score+=100,collection.play()):(player.lives.pop(),miss.play()):"gate2"==e?gate2.need==player.value||2==gate2.need?(1==collected2x?player.score+=200:player.score+=100,collection.play()):(player.lives.pop(),miss.play()):"gate3"==e?gate3.need==player.value||2==gate3.need?(1==collected2x?player.score+=200:player.score+=100,collection.play()):(player.lives.pop(),miss.play()):player.lives.pop()}function resetGates(e){if(1==e){for(changeGate(1),gate1.rate=Math.floor(4*Math.random()+1);gate1.rate==gate2.rate||gate1.rate==gate3.rate;)gate1.rate=Math.floor(4*Math.random()+1);gate1.y=-200}else if(2==e){for(changeGate(2),gate2.rate=Math.floor(4*Math.random()+1);gate2.rate==gate1.rate||gate2.rate==gate3.rate;)gate2.rate=Math.floor(4*Math.random()+1);gate2.y=-200}else if(3==e){for(changeGate(3),gate3.rate=Math.floor(4*Math.random()+1);gate3.rate==gate1.rate||gate3.rate==gate2.rate;)gate3.rate=Math.floor(4*Math.random()+1);gate3.y=-200}}function checkCollision(){gate1.y-10>=canvas.height&&resetGates(1),gate2.y-10>=canvas.height&&resetGates(2),gate3.y-10>=canvas.height&&resetGates(3),ball.x>=gate1.x&&ball.x<=gate1.x+60&&gate1.y+120>=ball.radius+ball.y&&(checkMatch("gate1"),resetGates(1)),ball.x>=gate2.x&&ball.x<=gate2.x+60&&gate2.y+120>=ball.radius+ball.y&&(checkMatch("gate2"),resetGates(2)),ball.x>=gate3.x&&ball.x<=gate3.x+60&&gate3.y+120>=ball.radius+ball.y&&(checkMatch("gate3"),resetGates(3)),doublepts.y-20>=canvas.height&&(doublepts.x=Math.random()*canvas.width,doublepts.y=-100,doubleptstimer=Math.floor(6e4*(Math.random()+1)),ref_time2x=new Date,ref_time2x_ms=ref_time2x.getTime(),spawn2x=!1),ball.x>=doublepts.x-20&&ball.x<=doublepts.x+20&&ball.y<=doublepts.y+20&&ball.y>=doublepts.y-20&&(collected2x=!0,collected2x_time=new Date,collected2x_time_ms=collected2x_time.getTime(),collected2x_limit=collected2x_time_ms+15e3,doublepts_sound.play(),spawn2x=!1,doublepts.y=-100),extralife.y-20>=canvas.height&&(extralife.x=Math.random()*canvas.width,extralife.y=-100,extralifetimer=Math.floor(6e4*(Math.random()+2)),spawnlife=!1),ball.x>=extralife.x-20&&ball.x<=extralife.x+20&&ball.y<=extralife.y+20&&ball.y>=extralife.y-20&&(extralife.y=-100,extralife_sound.play(),player.lives.push("L"),spawnlife=!1)}function setUpScreen(e){var t=Math.floor(1e3/(e-previousFrameTime));document.getElementById("framesPerSecond").innerHTML=t+" FPS",previousFrameTime=e,ctx.font="12px Verdana",ctx.clearRect(0,0,canvas.width,canvas.height),document.getElementById("score").innerHTML="Score: "+player.score,document.getElementById("lives").innerHTML="Lives: "+player.lives.length}function changePlayerValue(){0==player.value?player.value=1:player.value=0}function pause(){0==paused?paused=!paused:(paused=!paused,requestAnimationFrame(draw))}function draw(e){setUpScreen(e),checkCollision(),drawGate(gate1.x,gate1.y,gate1.type),drawGate(gate2.x,gate2.y,gate2.type),drawGate(gate3.x,gate3.y,gate3.type),drawBall(),ctx.fillStyle="#FF0000",ctx.fillText(player.value,ball.x-4,ball.y+3);var t=new Date,a=t.getTime();1e3>=ref_time2x_ms+doubleptstimer-a&&ref_time2x_ms+doubleptstimer-a>=0&&(spawn2x=!0),1e3>=ref_timelife_ms+extralifetimer-a&&ref_timelife_ms+extralifetimer-a>=0&&(spawnlife=!0),1==spawn2x&&(draw2x(),doublepts.alpha=doublepts.alpha-.005,doublepts.alpha<=0&&(doublepts.alpha=1),doublepts.y=doublepts.y+2,ctx.fillStyle="#FFFF00",ctx.font="20px Verdana",ctx.fillText("2x",doublepts.x-8,doublepts.y+6),ctx.fillStyle="#FF0000",ctx.font="12px Verdana"),1==spawnlife&&(drawextralife(),extralife.alpha=extralife.alpha-.01,extralife.alpha<=0&&(extralife.alpha=1),extralife.y=extralife.y+2,ctx.fillStyle="#1D7CF2",ctx.font="16px Verdana",ctx.fillText("1UP",extralife.x-12,extralife.y+6),ctx.fillStyle="#FF0000",ctx.font="12px Verdana"),1==collected2x&&(ctx.fillText("2x: "+Math.floor((collected2x_limit-a)/1e3)+" Sec",0,canvas.height/2),a>=collected2x_limit&&(doublepts.x=Math.random()*canvas.width,doublepts.y=-100,doubleptstimer=Math.floor(6e4*(Math.random()+1)),ref_time2x=new Date,ref_time2x_ms=ref_time2x.getTime(),collected2x=!1)),gate1.y=gate1.y+gate1.rate,gate2.y=gate2.y+gate2.rate,gate3.y=gate3.y+gate3.rate;var l={rate1:gate1.rate,rate2:gate2.rate,rate3:gate3.rate};speedVis.update(l),rightPressed&&ball.x+ball.radius<canvas.width&&(ball.x+=4),leftPressed&&ball.x-ball.radius>0&&(ball.x-=4),canvas.onclick=changePlayerValue,0==player.lives&&(ctx.clearRect(0,0,canvas.width,canvas.height),document.getElementById("gameOverScore").innerHTML="You scored "+player.score+" points!",checkHighScore(),pause(),ctx.textAlign="start"),paused||requestAnimationFrame(draw)}function checkHighScore(){var e=Parse.Object.extend("Score"),t=new Parse.Query(e);t.lessThan("score",player.score),t.count({success:function(e){e>0?loadNewHighScoreScreen():loadEndMenu()},error:function(e){alert("Error retrieving high scores"),loadEndMenu()}})}function addNewHighScore(){player_Name=document.getElementById("nameInput").value,deleteLowScore(),pushNewHighScore(),refreshHighScores(),loadEndMenu()}function deleteLowScore(){var e=Parse.Object.extend("Score"),t=new Parse.Query(e);t.ascending("score"),t.first({success:function(e){e.destroy({success:function(e){console.log("Object deleted from cloud")},error:function(e,t){alert("object not deleted from cloud")}})},error:function(e){alert("Error retrieving high scores")}})}function pushNewHighScore(){var e=Parse.Object.extend("Score"),t=new e;t.set("score",player.score),t.set("playerName",player_Name),t.save(null,{success:function(e){console.log("new high score saved succesfully")},error:function(e,t){alert("Failed to save high score")}})}function refreshHighScores(){var e=Parse.Object.extend("Score"),t=new Parse.Query(e);t.descending("score"),t.find({success:function(e){for(var t=0;t<e.length&&10>t;t++){var a=e[t];9==t?document.getElementById("highScore"+(t+1)).innerHTML=t+1+". "+a.get("playerName")+" - "+a.get("score")+"pts":document.getElementById("highScore"+(t+1)).innerHTML=t+1+".   "+a.get("playerName")+" - "+a.get("score")+"pts"}for(var t=0;t<e.length&&10>t;t++){var a=e[t];9==t?document.getElementById("highScoreEnd"+(t+1)).innerHTML=t+1+". "+a.get("playerName")+" - "+a.get("score")+"pts":document.getElementById("highScoreEnd"+(t+1)).innerHTML=t+1+".   "+a.get("playerName")+" - "+a.get("score")+"pts"}},error:function(e){alert("Error retrieving high scores")}})}function loadConfiguration(){var e=document.getElementsByClassName("ui");for(i=0;i<e.length;++i)e[i].style.display="none";ctx.font="20px Verdana",ctx.textAlign="center",ctx.fillText("Input left movement key",canvas.width/2,canvas.height/2),document.addEventListener("keydown",assignleft,!1)}function assignleft(e){leftkey=e.keyCode,ctx.clearRect(0,0,canvas.width,canvas.height),ctx.fillText("Input right movement key",canvas.width/2,canvas.height/2),document.addEventListener("keydown",assignright,!1),document.removeEventListener("keydown",assignleft,!1),ctx.textAlign="start"}function assignright(e){rightkey=e.keyCode,ctx.clearRect(0,0,canvas.width,canvas.height),loadoptions(),document.removeEventListener("keydown",assignright,!1)}function loadControls(){var e=document.getElementsByClassName("ui");for(i=0;i<e.length;++i)e[i].style.display="none";for(e=document.getElementsByClassName("controls"),i=0;i<e.length;++i)e[i].style.display="inline"}function loadHowToPlay(){var e=document.getElementsByClassName("ui");for(i=0;i<e.length;++i)e[i].style.display="none";for(e=document.getElementsByClassName("howToPlay"),i=0;i<e.length;++i)e[i].style.display="inline"}function loadoptions(){var e=document.getElementsByClassName("ui");for(i=0;i<e.length;++i)e[i].style.display="none";for(e=document.getElementsByClassName("options"),i=0;i<e.length;++i)e[i].style.display="inline"}function loadMainMenu(){refreshHighScores();var e=document.getElementsByClassName("ui");for(i=0;i<e.length;++i)e[i].style.display="none";for(e=document.getElementsByClassName("mainMenu"),i=0;i<e.length;++i)e[i].style.display="inline"}function loadNewHighScoreScreen(){var e=document.getElementsByClassName("ui");for(i=0;i<e.length;++i)e[i].style.display="none";for(e=document.getElementsByClassName("newHighScoreScreen"),i=0;i<e.length;++i)e[i].style.display="inline"}function loadHighScores(){refreshHighScores();var e=document.getElementsByClassName("ui");for(i=0;i<e.length;++i)e[i].style.display="none";for(e=document.getElementsByClassName("highScores"),i=0;i<e.length;++i)e[i].style.display="inline"}function loadEndMenu(){refreshHighScores();var e=document.getElementsByClassName("ui");for(i=0;i<e.length;++i)e[i].style.display="none";for(e=document.getElementsByClassName("endGame"),i=0;i<e.length;++i)e[i].style.display="inline";setTimeout(refreshHighScores,2500)}function newGame(){var e=document.getElementsByClassName("ui");for(i=0;i<e.length;++i)e[i].style.display="none";for(e=document.getElementsByClassName("inGame"),i=0;i<e.length;++i)e[i].style.display="inline";for(player={lives:["L","L","L","L","L","L","L","L","L","L"],score:0,value:1},gate1={need:0,x:canvas.width/4,y:-200,type:3,rate:Math.floor(4*Math.random()+1)},gate2={need:1,x:2*(canvas.width/4),y:-200,type:14,rate:Math.floor(4*Math.random()+1)},gate3={need:0,x:3*(canvas.width/4),y:-200,type:9,rate:Math.floor(4*Math.random()+1)};gate2.rate==gate1.rate;)gate2.rate=Math.floor(4*Math.random()+1);for(;gate3.rate==gate2.rate||gate3.rate==gate1.rate;)gate3.rate=Math.floor(4*Math.random()+1);extralife={radius:20,x:Math.random()*canvas.width,y:-100,alpha:1},extralife.x=Math.random()*canvas.width,extralife.y=-100,ref_timelife=new Date,ref_timelife_ms=ref_timelife.getTime(),spawnlife=!1,doublepts.x=Math.random()*canvas.width,doublepts.y=-100,doubleptstimer=Math.floor(6e4*(Math.random()+1)),ref_time2x=new Date,ref_time2x_ms=ref_time2x.getTime(),spawn2x=!1,collected2x=!1,paused=!1,requestAnimationFrame(draw)}function quitGame(){paused=!0,requestAnimationFrame(clearscreen),loadMainMenu()}function clearscreen(){ctx.clearRect(0,0,canvas.width,canvas.height)}Parse.initialize("AfffIqRQX8tPjgqj7lO935JbzMsISdKgJQNNfFtw","VsEBibf30t1iYMvCqlZjF9bQaDwKtRvR4skPZ9AJ");for(var previousFrameTime=0,canvas=document.getElementById("myCanvas"),ctx=canvas.getContext("2d"),player_Name,match=!1,paused=!1,upPressed=!1,downPressed=!1,rightPressed=!1,leftPressed=!1,spacePressed=!1,leftkey=37,rightkey=39,gateType0=document.getElementById("AND00x"),gateType1=document.getElementById("AND0x0"),gateType2=document.getElementById("AND0x1"),gateType3=document.getElementById("AND01x"),gateType4=document.getElementById("AND1x0"),gateType5=document.getElementById("AND1x1"),gateType6=document.getElementById("AND10x"),gateType7=document.getElementById("AND11x"),gateType8=document.getElementById("OR00x"),gateType9=document.getElementById("OR0x0"),gateType10=document.getElementById("OR0x1"),gateType11=document.getElementById("OR01x"),gateType12=document.getElementById("OR1x0"),gateType13=document.getElementById("OR1x1"),gateType14=document.getElementById("OR10x"),gateType15=document.getElementById("OR11x"),ball={radius:10,x:canvas.width/2,y:canvas.height-30},player={lives:["L","L","L","L","L","L","L","L","L","L"],score:0,value:1},gate1={need:0,x:canvas.width/4,y:-200,type:3,rate:Math.floor(4*Math.random()+1)},gate2={need:1,x:2*(canvas.width/4),y:-200,type:14,rate:Math.floor(4*Math.random()+1)},gate3={need:0,x:3*(canvas.width/4),y:-200,type:9,rate:Math.floor(4*Math.random()+1)};gate2.rate==gate1.rate;)gate2.rate=Math.floor(4*Math.random()+1);for(;gate3.rate==gate2.rate||gate3.rate==gate1.rate;)gate3.rate=Math.floor(4*Math.random()+1);var rate={rate1:gate1.rate,rate2:gate2.rate,rate3:gate3.rate},speedVis=new test;speedVis.structure("speed").location("#speedDiv").data(rate).visualize(),document.addEventListener("keydown",keyDownHandler,!1),document.addEventListener("keyup",keyUpHandler,!1);var collection=new Audio("../Sounds/Collection.mp3"),miss=new Audio("../Sounds/Miss.mp3"),music=new Audio("../Sounds/Music.mp3"),mute=!1,bgm=document.getElementById("bgm"),sfx=document.getElementById("sfx"),doublepts={radius:20,x:Math.random()*canvas.width,y:-100,alpha:1},doubleptstimer=Math.floor(6e4*(Math.random()+1)),ref_time2x=new Date,ref_time2x_ms=ref_time2x.getTime(),spawn2x=!1,collected2x=!1,collected2x_time,collected2x_time_ms,collected2x_limit,doublepts_sound=new Audio("../Sounds/Doublepts.ogg"),extralife={radius:20,x:Math.random()*canvas.width,y:-100,alpha:1},extralifetimer=Math.floor(6e4*(Math.random()+2)),ref_timelife=new Date,ref_timelife_ms=ref_timelife.getTime(),spawnlife=!1,extralife_sound=new Audio("../Sounds/One_up.ogg");$(document).on("mousemove",function(e){var t=canvas.getBoundingClientRect();e.clientX-t.left-ball.radius>0&&e.clientX-t.left+ball.radius<canvas.width&&e.clientY-t.top>0&&e.clientY-t.top<canvas.height&&(ball.x=e.clientX-t.left)}),music.addEventListener("ended",function(){this.currentTime=0,this.play()},!1),bgm.addEventListener("change",function(){music.volume=bgm.value/100}),sfx.addEventListener("change",function(){collection.volume=sfx.value/100,miss.volume=sfx.value/100}),music.play(),loadMainMenu();
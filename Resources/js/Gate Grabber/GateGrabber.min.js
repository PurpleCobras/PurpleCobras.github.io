function keyDownHandler(e){39==e.keyCode&&(rightPressed=!0),37==e.keyCode&&(leftPressed=!0),38==e.keyCode&&(upPressed=!0),40==e.keyCode&&(downPressed=!0),32==e.keyCode&&(spacePressed=!0),77==e.keyCode&&(0==mute?(mute=!0,music.pause(),music.currentTime=0):1==mute&&(mute=!1,music.play()))}function keyUpHandler(e){39==e.keyCode&&(rightPressed=!1),37==e.keyCode&&(leftPressed=!1),38==e.keyCode&&(upPressed=!1),40==e.keyCode&&(downPressed=!1),32==e.keyCode&&(spacePressed=!1)}function drawBall(){ctx.beginPath(),ctx.arc(ball.x,ball.y,ball.radius,0,2*Math.PI),ctx.fillStyle="#000000",ctx.fill(),ctx.closePath()}function drawGate(e,t,a){0==a?(ctx.beginPath(),ctx.drawImage(gateType0,e,t,60,120),ctx.closePath()):1==a?(ctx.beginPath(),ctx.drawImage(gateType1,e,t,60,120),ctx.closePath()):2==a?(ctx.beginPath(),ctx.drawImage(gateType2,e,t,60,120),ctx.closePath()):3==a?(ctx.beginPath(),ctx.drawImage(gateType3,e,t,60,120),ctx.closePath()):4==a?(ctx.beginPath(),ctx.drawImage(gateType4,e,t,60,120),ctx.closePath()):5==a?(ctx.beginPath(),ctx.drawImage(gateType5,e,t,60,120),ctx.closePath()):6==a?(ctx.beginPath(),ctx.drawImage(gateType6,e,t,60,120),ctx.closePath()):7==a?(ctx.beginPath(),ctx.drawImage(gateType7,e,t,60,120),ctx.closePath()):8==a?(ctx.beginPath(),ctx.drawImage(gateType8,e,t,60,120),ctx.closePath()):9==a?(ctx.beginPath(),ctx.drawImage(gateType9,e,t,60,120),ctx.closePath()):10==a?(ctx.beginPath(),ctx.drawImage(gateType10,e,t,60,120),ctx.closePath()):11==a?(ctx.beginPath(),ctx.drawImage(gateType11,e,t,60,120),ctx.closePath()):12==a?(ctx.beginPath(),ctx.drawImage(gateType12,e,t,60,120),ctx.closePath()):13==a?(ctx.beginPath(),ctx.drawImage(gateType13,e,t,60,120),ctx.closePath()):14==a?(ctx.beginPath(),ctx.drawImage(gateType14,e,t,60,120),ctx.closePath()):15==a&&(ctx.beginPath(),ctx.drawImage(gateType15,e,t,60,120),ctx.closePath())}function changeGate(e){1==e&&(temp=Math.floor(16*Math.random()),gate1.type=temp,gate1.need=neededValue(gate1.type)),2==e&&(temp=Math.floor(16*Math.random()),gate2.type=temp,gate2.need=neededValue(gate2.type)),3==e&&(temp=Math.floor(16*Math.random()),gate3.type=temp,gate3.need=neededValue(gate3.type))}function neededValue(e){var t=0;return 0==e?t=2:1==e?t=2:2==e?t=0:3==e?t=0:4==e?t=3:5==e?t=1:6==e?t=3:7==e?t=1:8==e?t=0:9==e?t=0:10==e?t=3:11==e?t=3:12==e?t=1:13==e?t=2:14==e?t=1:15==e&&(t=2),t}function checkMatch(e){"gate1"==e?gate1.need==player.value||2==gate1.need?(player.score+=100,collection.play()):(player.lives.pop(),miss.play()):"gate2"==e?gate2.need==player.value||2==gate2.need?(player.score+=100,collection.play()):(player.lives.pop(),miss.play()):"gate3"==e?gate3.need==player.value||2==gate3.need?(player.score+=100,collection.play()):(player.lives.pop(),miss.play()):player.lives.pop()}function resetGates(e){if(1==e){for(changeGate(1),gate1.rate=Math.floor(4*Math.random()+1);gate1.rate==gate2.rate||gate1.rate==gate3.rate;)gate1.rate=Math.floor(4*Math.random()+1);gate1.y=-200}else if(2==e){for(changeGate(2),gate2.rate=Math.floor(4*Math.random()+1);gate2.rate==gate1.rate||gate2.rate==gate3.rate;)gate2.rate=Math.floor(4*Math.random()+1);gate2.y=-200}else if(3==e){for(changeGate(3),gate3.rate=Math.floor(4*Math.random()+1);gate3.rate==gate1.rate||gate3.rate==gate2.rate;)gate3.rate=Math.floor(4*Math.random()+1);gate3.y=-200}}function checkCollision(){gate1.y-10>=canvas.height&&resetGates(1),gate2.y-10>=canvas.height&&resetGates(2),gate3.y-10>=canvas.height&&resetGates(3),ball.x>=gate1.x&&ball.x<=gate1.x+60&&gate1.y+120>=ball.radius+ball.y&&(checkMatch("gate1"),resetGates(1)),ball.x>=gate2.x&&ball.x<=gate2.x+60&&gate2.y+120>=ball.radius+ball.y&&(checkMatch("gate2"),resetGates(2)),ball.x>=gate3.x&&ball.x<=gate3.x+60&&gate3.y+120>=ball.radius+ball.y&&(checkMatch("gate3"),resetGates(3))}function setUpScreen(e){var t=Math.floor(1e3/(e-previousFrameTime));document.getElementById("framesPerSecond").innerHTML=t+" FPS",previousFrameTime=e,ctx.font="12px Verdana",ctx.clearRect(0,0,canvas.width,canvas.height),document.getElementById("score").innerHTML="Score: "+player.score,document.getElementById("lives").innerHTML="Lives: "+player.lives.length}function changePlayerValue(){0==player.value?player.value=1:player.value=0}function pause(){0==paused?paused=!paused:(paused=!paused,requestAnimationFrame(draw))}function draw(e){setUpScreen(e),checkCollision(),drawGate(gate1.x,gate1.y,gate1.type),drawGate(gate2.x,gate2.y,gate2.type),drawGate(gate3.x,gate3.y,gate3.type),drawBall(),ctx.fillStyle="#FF0000",ctx.fillText(player.value,ball.x-4,ball.y+3),gate1.y=gate1.y+gate1.rate,gate2.y=gate2.y+gate2.rate,gate3.y=gate3.y+gate3.rate;var t={rate1:gate1.rate,rate2:gate2.rate,rate3:gate3.rate};speedVis.update(t),rightPressed&&ball.x+ball.radius<canvas.width&&(ball.x+=4),leftPressed&&ball.x-ball.radius>0&&(ball.x-=4),canvas.onclick=changePlayerValue,0==player.lives&&(ctx.clearRect(0,0,canvas.width,canvas.height),document.getElementById("gameOverScore").innerHTML="You scored "+player.score+" points!",loadEndMenu(),pause(),ctx.textAlign="start"),paused||requestAnimationFrame(draw)}function loadControls(){var e=document.getElementsByClassName("ui");for(i=0;i<e.length;++i)e[i].style.display="none";for(e=document.getElementsByClassName("controls"),i=0;i<e.length;++i)e[i].style.display="inline"}function loadHowToPlay(){var e=document.getElementsByClassName("ui");for(i=0;i<e.length;++i)e[i].style.display="none";for(e=document.getElementsByClassName("howToPlay"),i=0;i<e.length;++i)e[i].style.display="inline"}function loadoptions(){var e=document.getElementsByClassName("ui");for(i=0;i<e.length;++i)e[i].style.display="none";for(e=document.getElementsByClassName("options"),i=0;i<e.length;++i)e[i].style.display="inline"}function loadMainMenu(){var e=document.getElementsByClassName("ui");for(i=0;i<e.length;++i)e[i].style.display="none";for(e=document.getElementsByClassName("mainMenu"),i=0;i<e.length;++i)e[i].style.display="inline";requestAnimationFrame(mainMenuAnimation)}function loadEndMenu(){var e=document.getElementsByClassName("ui");for(i=0;i<e.length;++i)e[i].style.display="none";for(e=document.getElementsByClassName("endGame"),i=0;i<e.length;++i)e[i].style.display="inline"}function newGame(){var e=document.getElementsByClassName("ui");for(i=0;i<e.length;++i)e[i].style.display="none";for(e=document.getElementsByClassName("inGame"),i=0;i<e.length;++i)e[i].style.display="inline";for(player={lives:["L","L","L","L","L","L","L","L","L","L"],score:0,value:1},gate1={need:0,x:canvas.width/4,y:-200,type:3,rate:Math.floor(4*Math.random()+1)},gate2={need:1,x:2*(canvas.width/4),y:-200,type:14,rate:Math.floor(4*Math.random()+1)},gate3={need:0,x:3*(canvas.width/4),y:-200,type:9,rate:Math.floor(4*Math.random()+1)};gate2.rate==gate1.rate;)gate2.rate=Math.floor(4*Math.random()+1);for(;gate3.rate==gate2.rate||gate3.rate==gate1.rate;)gate3.rate=Math.floor(4*Math.random()+1);paused=!1,requestAnimationFrame(draw)}function quitGame(){paused=!0,requestAnimationFrame(clearscreen),loadMainMenu()}function clearscreen(){ctx.clearRect(0,0,canvas.width,canvas.height)}for(var previousFrameTime=0,canvas=document.getElementById("myCanvas"),ctx=canvas.getContext("2d"),match=!1,paused=!1,upPressed=!1,downPressed=!1,rightPressed=!1,leftPressed=!1,spacePressed=!1,gateType0=document.getElementById("AND00x"),gateType1=document.getElementById("AND0x0"),gateType2=document.getElementById("AND0x1"),gateType3=document.getElementById("AND01x"),gateType4=document.getElementById("AND1x0"),gateType5=document.getElementById("AND1x1"),gateType6=document.getElementById("AND10x"),gateType7=document.getElementById("AND11x"),gateType8=document.getElementById("OR00x"),gateType9=document.getElementById("OR0x0"),gateType10=document.getElementById("OR0x1"),gateType11=document.getElementById("OR01x"),gateType12=document.getElementById("OR1x0"),gateType13=document.getElementById("OR1x1"),gateType14=document.getElementById("OR10x"),gateType15=document.getElementById("OR11x"),ball={radius:10,x:canvas.width/2,y:canvas.height-30},player={lives:["L","L","L","L","L","L","L","L","L","L"],score:0,value:1},gate1={need:0,x:canvas.width/4,y:-200,type:3,rate:Math.floor(4*Math.random()+1)},gate2={need:1,x:2*(canvas.width/4),y:-200,type:14,rate:Math.floor(4*Math.random()+1)},gate3={need:0,x:3*(canvas.width/4),y:-200,type:9,rate:Math.floor(4*Math.random()+1)};gate2.rate==gate1.rate;)gate2.rate=Math.floor(4*Math.random()+1);for(;gate3.rate==gate2.rate||gate3.rate==gate1.rate;)gate3.rate=Math.floor(4*Math.random()+1);var rate={rate1:gate1.rate,rate2:gate2.rate,rate3:gate3.rate},speedVis=new test;speedVis.structure("speed").location("#speedDiv").data(rate).visualize(),document.addEventListener("keydown",keyDownHandler,!1),document.addEventListener("keyup",keyUpHandler,!1);var collection=new Audio("../Sounds/Collection.mp3"),miss=new Audio("../Sounds/Miss.mp3"),music=new Audio("../Sounds/Music.mp3"),mute=!1,bgm=document.getElementById("bgm"),sfx=document.getElementById("sfx");$(document).on("mousemove",function(e){var t=canvas.getBoundingClientRect();e.clientX-t.left-ball.radius>0&&e.clientX-t.left+ball.radius<canvas.width&&e.clientY-t.top>0&&e.clientY-t.top<canvas.height&&(ball.x=e.clientX-t.left)}),music.addEventListener("ended",function(){this.currentTime=0,this.play()},!1),bgm.addEventListener("change",function(){music.volume=bgm.value/100}),sfx.addEventListener("change",function(){collection.volume=sfx.value/100,miss.volume=sfx.value/100}),music.play(),loadMainMenu();